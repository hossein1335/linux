๐น nftables ฺุณุชุ
nftables ูุณู ุฌุฏุฏ ุณุณุชู ูุงุฑูุงู ุฏุฑ ูููฺฉุณ ุงุณุช ฺฉู ุฌุงฺฏุฒู iptables ุดุฏู. ุงู ุงุจุฒุงุฑ ุฑู netfilter framework ฺฉุฑูู ฺฉุงุฑ ูโฺฉูุฏ ู ูุธููโุงุด ฺฉูุชุฑู ู ููุชุฑ ฺฉุฑุฏู ุชุฑุงูฺฉ ุดุจฺฉู (ูุซู NATุ ููุชุฑ ูพฺฉุชุ ูุณุฑุงุจ ู ...) ุงุณุช.

๐ ูฺฺฏโูุง ููู nftables

โ ุฌุงฺฏุฒู ููู ุงุจุฒุงุฑูุง ูุฏู ูุซู iptables, ip6tables, arptables, ebtables ุดุฏู

โ ุฏุณุชูุฑูุง ฺฉูุชุงูโุชุฑ ู ุฎูุงูุงุชุฑ ุงุฒ iptables ูุณุชูุฏ

โ ุณุฑุนุช ู ฺฉุงุฑุง ุจุงูุงุชุฑ ฺูู ููุงูู ุจู ุตูุฑุช bytecode ุฏุงุฎู ฺฉุฑูู ุงุฌุฑุง ูโุดููุฏ

โ ุงูุนุทุงูโูพุฐุฑ ุจุดุชุฑ ุจุง ุงูฺฉุงู ุงุณุชูุงุฏู ุงุฒ sets (ูุฌููุนู ุขโูพ ุง ูพูุฑุช) ู maps

โ ููุท ุจุง ฺฉ ุงุจุฒุงุฑ (nft) ููู ูุฏุฑุช ุงูุฌุงู ูโุดูุฏ

๐น ฑ. ุณุงุฎุชุงุฑ ฺฉู
nftables ุงุฒ ุณู ุจุฎุด ุงุตู ุชุดฺฉู ูโุดู:

Table (ุฌุฏูู) โ ูุซู ฺฉ ุธุฑู ุงุตู ุจุฑุง ูฺฏูโุฏุงุดุชู ููุงูู.

Chain (ุฒูุฌุฑู) โ ุฏุงุฎู ูุฑ ุฌุฏูู ฺูุฏ chain ูุฌูุฏ ุฏุงุฑู ฺฉู ูุดุฎุต ูโฺฉูู ููุงูู ฺฉุฌุง ุงุฌุฑุง ุจุดู (ูุฑูุฏุ ุฎุฑูุฌุ ููุฑูุงุฑุฏ).

Rule (ูุงููู) โ ูููู ุฏุณุชูุฑุงุช ู ุดุฑุทโูุง ฺฉู ูุดุฎุต ูโฺฉูู ุจุง ูุฑ ูพฺฉุช ฺู ฺฉุงุฑ ุจุดู (ูุจููุ ุฑุฏุ ุชุบุฑ ู โฆ).

๐น ฒ. ููุงุท ุงุชุตุงู (Hooks)
๐น hook ฺูุ
ุชู nftablesุ hook ุนู ููุทูโุง ุงุฒ ูุณุฑ ุญุฑฺฉุช ูพฺฉุชโูุง ุฏุงุฎู ฺฉุฑูู ฺฉู ูโุชูู ุงููุฌุง ูุงูููโูุงุช ุฑู ุงุฌุฑุง ฺฉู.

ููุช ู ูพฺฉุช ูุงุฑุฏ ุณุณุชู ูโุดู ุง ุงุฒุด ุฎุงุฑุฌ ูโุดูุ ูุฑุงุญู ูุฎุชูู ุฑู ุชู ฺฉุฑูู ุฑุฏ ูโฺฉูู. nftables ุจูุช ุงุฌุงุฒู ูโุฏู chainโูุงุช ุฑู ุจู ุงู ูุฑุงุญู (ูููู hookูุง) ูุตู ฺฉู.

๐ ูููโุชุฑู hookูุง

prerouting โ ูุจู ุงุฒ ุงูฺฉู ฺฉุฑูู ุชุตูู ุจฺฏุฑู ูพฺฉุช ฺฉุฌุง ุจุฑู (ููุงุณุจ ุจุฑุง DNAT).

input โ ููุช ูพฺฉุช ุจู ุฎูุฏ ุณุณุชู ูุงุฏ (ูุซูุงู SSH ุจู ูููู ุณุฑูุฑ).

forward โ ููุช ุณุณุชู ููุด ุฑูุชุฑ ุฏุงุฑู ู ูพฺฉุช ุจุงุฏ ุจู ู ููุตุฏ ุฏฺฏู ุจุฑู.

output โ ูพฺฉุชโูุง ฺฉู ุฎูุฏ ุณุณุชู ุชููุฏ ูโฺฉูู (ูุซูุงู ููุช ุณุฑูุฑ ุดูุง ping ูโูุฑุณุชู).

postrouting โ ุฏุฑุณุช ูุจู ุงุฒ ุฎุฑูุฌ ูพฺฉุช ุงุฒ ุณุณุชู (ููุงุณุจ ุจุฑุง SNAT ุง ูุงุณฺฉโฺฉุฑุฏู).

๐น ณ. ุงุฌุฑุง ููุงูู
ููุช ฺฉ ูพฺฉุช ูุงุฑุฏ ุณุณุชู ูโุดู:

ุจู ุฌุฏูู ูุฑุจูุท ูโุฑู.

ูุงุฑุฏ chain ูุดุฎุต ูโุดู.

ููุงูู ฺฉโฺฉ ุจุฑุฑุณ ูโุดู.

ุงููู ูุงููู ฺฉู ุดุฑุงุทุด ุฏุฑุณุช ุจุงุดูุ ุฑู ูพฺฉุช ุงุนูุงู ูโุดู (ูุซูุงู accept ุง drop).

๐น ด. ุงูุนุทุงูโูพุฐุฑ

ูโุชูู ฺูุฏู ุฌุฏูู ู chain ุจุณุงุฒ.

ูโุชูู ุงุฒ set ุงุณุชูุงุฏู ฺฉู (ูุซูุงู ู ูุณุช ุขโูพ ูุฌุงุฒ ุฏุฑุณุช ฺฉู ู ุจูโุฌุง ฺูุฏ ูุงูููุ ฺฉ ูุงููู ุจููุณ).

ูโุชูู NAT ุง DNAT ู SNAT ูู ุจุงูุงุด ุงูุฌุงู ุจุฏ.



ูุงู ูพฺฉุฑุจูุฏ

ูุนูููุงู ูพฺฉุฑุจูุฏ nftables ุชู ู ูุงู ูุชู ูุซู /etc/nftables.conf ุฐุฎุฑู ูโุดู.

ุฏุฑ nftablesุ ุงููุงุน ุฌุฏููโูุง ูุดุฎุต ูโฺฉููุฏ ฺฉู ููุงูู ูุงุฑูุงู ุฑู ฺู ููุน ุชุฑุงูฺฉ ุงุนูุงู ุดููุฏ.

ฑ. ุฌุฏูู ip

ุจุฑุง ุชุฑุงูฺฉ IPv4 ุงุณุชูุงุฏู ูโุดูุฏ.

ูโุชูุงู ููุงูู ููุชุฑ ฺฉุฑุฏูุ NATุ ุง ูุฏุฑุช ูพูุฑุชโูุง ุฑู IPv4 ููุดุช.

ฒ. ุฌุฏูู ip6

ูุฎุตูุต ุชุฑุงูฺฉ IPv6 ุงุณุช.

ูุดุงุจู ุฌุฏูู ip ุงูุง ููุท ุจุฑุง ุขุฏุฑุณโูุง IPv6 ฺฉุงุฑุจุฑุฏ ุฏุงุฑุฏ.

ณ. ุฌุฏูู inet

ุชุฑฺฉุจ ุงุฒ IPv4 ู IPv6 ุงุณุช.

ุงุฌุงุฒู ูโุฏูุฏ ุจุง ฺฉ ุฌุฏูู ููุฒูุงู ุฑู IPv4 ู IPv6 ููุงูู ุจููุณู.

ุจู ุตุฑููโุชุฑ ุงุณุช ฺูู ูุงุฒ ุจู ุฏู ุฌุฏูู ุฌุฏุงฺฏุงูู ูุณุช.

ด. ุฌุฏูู arp

ุจุฑุง ูุฏุฑุช ุชุฑุงูฺฉ ARP ุงุณุชูุงุฏู ูโุดูุฏ.

ฺฉุงุฑุจุฑุฏุด ุจุดุชุฑ ุฏุฑ ุดุจฺฉูโูุง ูุญู ุงุณุช ฺฉู ูุงุฒ ุจู ฺฉูุชุฑู ุงุฑุชุจุงุท IP โ MAC ุฏุงุฑูุฏ.

ต. ุฌุฏูู bridge

ุจุฑุง ุดุจฺฉูโูุง ฺฉู ุงุฒ ุจุฑุฌ ุงุณุชูุงุฏู ูโฺฉููุฏ ฺฉุงุฑุจุฑุฏ ุฏุงุฑุฏ.

ูโุชูุงู ุชุฑุงูฺฉ ุจู ฺฉุงุฑุชโูุง ุดุจฺฉูโ bridge ุฑุง ฺฉูุชุฑู ฺฉุฑุฏ.

ถ. ุฌุฏูู netdev

ุจุฑุง ุงุนูุงู ููุงูู ูุณุชูู ุฑู ฺฉุงุฑุช ุดุจฺฉู (interface-level) ุงุณุชูุงุฏู ูโุดูุฏ.

ุจุฑุง ฺฉูุชุฑู ุชุฑุงูฺฉ ูุฑูุฏ ู ุฎุฑูุฌ ุงุฒ ุณุทุญ ุณุฎุชโุงูุฒุงุฑ ุดุจฺฉู ฺฉุงุฑุจุฑุฏ ุฏุงุฑุฏ.

