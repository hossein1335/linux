# 🔹 مفهوم کانکشن (Connection)

**کانکشن** یعنی **اتصال** بین دو سیستم، مثل ارتباط بین کلاینت (کاربر) و سرور.  
هر نوع ارتباط بسته به نوع پروتکل، روش انتقال داده، و پایداری اتصال فرق می‌کند.

---

## 🔸 انواع اصلی کانکشن‌ها

### ۱. Connection-Oriented (اتصال‌گرا)
در این نوع، قبل از تبادل داده، یک اتصال واقعی بین دو طرف برقرار می‌شود و تا پایان ارتباط باز می‌ماند.

📦 **داده‌ها به ترتیب و بدون گم شدن منتقل می‌شوند.**

⚙️ **پروتکل معروف:** TCP (Transmission Control Protocol)

✅ **مثال:**
- اتصال به وب‌سایت HTTPS
- استفاده از SSH

**فرآیند:** قبل از ارسال داده، یک **Three-way handshake** انجام می‌شود.

---

### ۲. Connectionless (بدون اتصال)
در این روش، داده‌ها بدون برقراری اتصال مستقیم ارسال می‌شوند.  
هر بسته‌ی داده جداگانه ارسال می‌شود و تضمینی نیست که به مقصد برسد یا ترتیبش درست باشد.

⚙️ **پروتکل معروف:** UDP (User Datagram Protocol)

✅ **مثال:**
- پخش زنده ویدیو
- تماس صوتی آنلاین (VoIP)

**ویژگی:** سرعت مهم‌تر از اطمینان است.

---

### ۳. Persistent Connection (اتصال پایدار)
بعد از ارسال داده، کانکشن باز می‌ماند تا برای درخواست‌های بعدی هم استفاده شود.

⚙️ **معمولاً در:** HTTP/1.1 و HTTP/2

✅ **مثال:**
مرورگر وقتی چند فایل (CSS، JS، تصاویر) را از یک سرور می‌گیرد، با یک کانکشن پایدار این کار را انجام می‌دهد.

---

### ۴. Non-Persistent Connection (اتصال ناپایدار)
برای هر درخواست یک اتصال جداگانه باز و بعد از پاسخ بسته می‌شود.

⚙️ **معمولاً در:** HTTP/1.0

❌ **عیب:** سربار زیاد (هر بار باید دوباره کانکشن بسازد).

---

### ۵. Secure Connection (اتصال امن)
ارتباط رمزنگاری می‌شود تا شخص سومی نتواند داده‌ها را ببیند یا تغییر دهد.

⚙️ **پروتکل‌ها:** HTTPS, SSH, TLS/SSL

✅ **مثال:**
وقتی آدرس سایتی با `https://` شروع می‌شود، یعنی از SSL/TLS برای رمزنگاری استفاده می‌کند.

---

### ۶. VPN Connection (اتصال مجازی خصوصی)
یک تونل رمزنگاری‌شده بین کاربر و سرور VPN ساخته می‌شود.  
ترافیک از مسیر امن و رمزنگاری‌شده عبور می‌کند.

✅ **مثال:**
- اتصال به شبکه شرکت از راه دور
- OpenVPN یا IPSec

---

## 🔹 وضعیت‌های TCP (TCP States)

هر اتصال TCP در هر لحظه در یکی از **وضعیت‌ها (states)** قرار دارد.  
این وضعیت‌ها مشخص می‌کنند که اتصال در چه مرحله‌ای از برقراری یا قطع ارتباط است.

### جدول وضعیت‌های مهم TCP

| وضعیت | معنی ساده | توضیح دقیق |
|-------|------------|-------------|
| **LISTEN** | در حال گوش دادن | سرور منتظر اتصال از سمت کلاینت است. (مثل `sshd` که منتظر کانکشن روی پورت 22 است) |
| **SYN_SENT** | درخواست ارسال شده | کلاینت درخواست اتصال (SYN) فرستاده و منتظر پاسخ از سرور است. |
| **SYN_RECV** | درخواست دریافت شده | سرور درخواست SYN را دریافت کرده و در حال پاسخ دادن است (مرحله دوم handshake). |
| **ESTABLISHED** | اتصال برقرار شده | ارتباط بین کلاینت و سرور برقرار است و داده در حال رد و بدل شدن است. |
| **FIN_WAIT1** | در حال پایان از سمت ارسال‌کننده | یکی از طرفین درخواست پایان (FIN) فرستاده و منتظر تأیید است. |
| **FIN_WAIT2** | در انتظار پایان طرف مقابل | درخواست پایان تأیید شده، حالا منتظر بسته‌ی FIN از طرف مقابل است. |
| **CLOSE_WAIT** | در انتظار بستن از سمت اپلیکیشن | طرف مقابل کانکشن را بست، ولی این طرف هنوز سوکت را نبسته. |
| **LAST_ACK** | در حال ارسال آخرین تأیید | بعد از دریافت FIN از طرف مقابل، در حال ارسال ACK نهایی است. |
| **TIME_WAIT** | منتظر پایان کامل اتصال | سیستم بعد از بسته شدن کامل، مدتی صبر می‌کند تا مطمئن شود بسته‌های قدیمی در شبکه نیستند. |
| **CLOSED** | بسته شده | اتصال کاملاً بسته شده است. |
